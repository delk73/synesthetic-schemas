{
  "$schemaRef": "jsonschema/rule-bundle.schema.json",
  "name": "SDF Grid Rules",
  "description": "A rule that maps interactions on a virtual grid to multimodal outputs by defining channels that link grid pressure to parameter changes.",
  "meta_info": {
    "category": "rule_bundle",
    "tags": [
      "grid",
      "interaction",
      "multimodal",
      "mapping",
      "client-side"
    ],
    "complexity": "high"
  },
  "rules": [
    {
      "id": "grid_to_multimodal_mapping",
      "trigger": {
        "type": "grid_cell",
        "params": {
          "gridSize": 8,
          "cooldown": 100
        }
      },
      "execution": "client",
      "effects": [
        {
          "channel": "audioTrigger",
          "target": "tone.synth",
          "op": "triggerAttackRelease",
          "value": {
            "note": "<grid.note>",
            "duration": "8n",
            "velocity": {
              "source": "grid.pressure",
              "scale": 1,
              "curve": "linear",
              "threshold": 0.02,
              "cell_overrides": [
                {
                  "coord": [
                    0,
                    0
                  ],
                  "threshold": 0.05,
                  "scale": 2
                },
                {
                  "coord": [
                    3,
                    2
                  ],
                  "curve": "exp"
                }
              ]
            }
          }
        },
        {
          "channel": "hapticPulse",
          "target": "haptic.intensity",
          "op": "set",
          "value": {
            "source": "grid.pressure",
            "scale": 1,
            "curve": "exp",
            "threshold": 0.02,
            "cell_overrides": [
              {
                "coord": [
                  3,
                  2
                ],
                "curve": "linear"
              }
            ]
          }
        },
        {
          "channel": "visualNudge",
          "target": "shader.u_r",
          "op": "add_pulse",
          "value": {
            "source": "grid.pressure",
            "scale": 0.1,
            "curve": "sigmoid",
            "threshold": 0.02
          }
        }
      ]
    }
  ]
}
